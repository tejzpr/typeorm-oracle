{"version":3,"sources":["../../src/query-runner/BaseQueryRunner.ts"],"names":[],"mappings":"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","file":"BaseQueryRunner.js","sourcesContent":["import {SqlInMemory} from \"../driver/SqlInMemory\";\r\nimport {PromiseUtils} from \"../util/PromiseUtils\";\r\nimport {Connection} from \"../connection/Connection\";\r\nimport {Table} from \"../schema-builder/table/Table\";\r\nimport {EntityManager} from \"../entity-manager/EntityManager\";\r\nimport {TableColumn} from \"../schema-builder/table/TableColumn\";\r\nimport {Broadcaster} from \"../subscriber/Broadcaster\";\r\n\r\nexport abstract class BaseQueryRunner {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Connection used by this query runner.\r\n     */\r\n    connection: Connection;\r\n\r\n    /**\r\n     * Entity manager working only with current query runner.\r\n     */\r\n    manager: EntityManager;\r\n\r\n    /**\r\n     * Indicates if connection for this query runner is released.\r\n     * Once its released, query runner cannot run queries anymore.\r\n     */\r\n    isReleased = false;\r\n\r\n    /**\r\n     * Indicates if transaction is in progress.\r\n     */\r\n    isTransactionActive = false;\r\n\r\n    /**\r\n     * Stores temporarily user data.\r\n     * Useful for sharing data with subscribers.\r\n     */\r\n    data = {};\r\n\r\n    /**\r\n     * All synchronized tables in the database.\r\n     */\r\n    loadedTables: Table[] = [];\r\n\r\n    /**\r\n     * Broadcaster used on this query runner to broadcast entity events.\r\n     */\r\n    broadcaster: Broadcaster;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Real database connection from a connection pool used to perform queries.\r\n     */\r\n    protected databaseConnection: any;\r\n\r\n    /**\r\n     * Indicates if special query runner mode in which sql queries won't be executed is enabled.\r\n     */\r\n    protected sqlMemoryMode: boolean = false;\r\n\r\n    /**\r\n     * Sql-s stored if \"sql in memory\" mode is enabled.\r\n     */\r\n    protected sqlInMemory: SqlInMemory = new SqlInMemory();\r\n\r\n    /**\r\n     * Mode in which query runner executes.\r\n     * Used for replication.\r\n     * If replication is not setup its value is ignored.\r\n     */\r\n    protected mode: \"master\"|\"slave\";\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Abstract Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Executes a given SQL query.\r\n     */\r\n    abstract query(query: string, parameters?: any[]): Promise<any>;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Abstract Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    protected abstract async loadTables(tablePaths: string[]): Promise<Table[]>;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Loads given table's data from the database.\r\n     */\r\n    async getTable(tablePath: string): Promise<Table|undefined> {\r\n        this.loadedTables = await this.loadTables([tablePath]);\r\n        return this.loadedTables.length > 0 ? this.loadedTables[0] : undefined;\r\n    }\r\n\r\n    /**\r\n     * Loads all tables (with given names) from the database.\r\n     */\r\n    async getTables(tableNames: string[]): Promise<Table[]> {\r\n        this.loadedTables = await this.loadTables(tableNames);\r\n        return this.loadedTables;\r\n    }\r\n\r\n    /**\r\n     * Enables special query runner mode in which sql queries won't be executed,\r\n     * instead they will be memorized into a special variable inside query runner.\r\n     * You can get memorized sql using getMemorySql() method.\r\n     */\r\n    enableSqlMemory(): void {\r\n        this.sqlInMemory = new SqlInMemory();\r\n        this.sqlMemoryMode = true;\r\n    }\r\n\r\n    /**\r\n     * Disables special query runner mode in which sql queries won't be executed\r\n     * started by calling enableSqlMemory() method.\r\n     *\r\n     * Previously memorized sql will be flushed.\r\n     */\r\n    disableSqlMemory(): void {\r\n        this.sqlInMemory = new SqlInMemory();\r\n        this.sqlMemoryMode = false;\r\n    }\r\n\r\n    /**\r\n     * Flushes all memorized sqls.\r\n     */\r\n    clearSqlMemory(): void {\r\n        this.sqlInMemory = new SqlInMemory();\r\n    }\r\n\r\n    /**\r\n     * Gets sql stored in the memory. Parameters in the sql are already replaced.\r\n     */\r\n    getMemorySql(): SqlInMemory {\r\n        return this.sqlInMemory;\r\n    }\r\n\r\n    /**\r\n     * Executes up sql queries.\r\n     */\r\n    async executeMemoryUpSql(): Promise<void> {\r\n        await PromiseUtils.runInSequence(this.sqlInMemory.upQueries, downQuery => this.query(downQuery));\r\n    }\r\n\r\n    /**\r\n     * Executes down sql queries.\r\n     */\r\n    async executeMemoryDownSql(): Promise<void> {\r\n        await PromiseUtils.runInSequence(this.sqlInMemory.downQueries.reverse(), downQuery => this.query(downQuery));\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Gets table from previously loaded tables, otherwise loads it from database.\r\n     */\r\n    protected async getCachedTable(tableName: string): Promise<Table> {\r\n        const table = this.loadedTables.find(table => table.name === tableName);\r\n        if (table) return table;\r\n\r\n        const foundTables = await this.loadTables([tableName]);\r\n        if (foundTables.length > 0) {\r\n            this.loadedTables.push(foundTables[0]);\r\n            return foundTables[0];\r\n        } else {\r\n            throw new Error(`Table \"${tableName}\" does not exist.`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Replaces loaded table with given changed table.\r\n     */\r\n    protected replaceCachedTable(table: Table, changedTable: Table): void {\r\n        const foundTable = this.loadedTables.find(loadedTable => loadedTable.name === table.name);\r\n        if (foundTable) {\r\n            foundTable.name = changedTable.name;\r\n            foundTable.columns = changedTable.columns;\r\n            foundTable.indices = changedTable.indices;\r\n            foundTable.foreignKeys = changedTable.foreignKeys;\r\n            foundTable.uniques = changedTable.uniques;\r\n            foundTable.checks = changedTable.checks;\r\n            foundTable.justCreated = changedTable.justCreated;\r\n            foundTable.engine = changedTable.engine;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if at least one of column properties was changed.\r\n     * Does not checks column type, length and autoincrement, because these properties changes separately.\r\n     */\r\n    protected isColumnChanged(oldColumn: TableColumn, newColumn: TableColumn, checkDefault?: boolean, checkComment?: boolean): boolean {\r\n        // this logs need to debug issues in column change detection. Do not delete it!\r\n\r\n        // console.log(\"charset ---------------\");\r\n        // console.log(oldColumn.charset !== newColumn.charset);\r\n        // console.log(oldColumn.charset, newColumn.charset);\r\n        // console.log(\"collation ---------------\");\r\n        // console.log(oldColumn.collation !== newColumn.collation);\r\n        // console.log(oldColumn.collation, newColumn.collation);\r\n        // console.log(\"precision ---------------\");\r\n        // console.log(oldColumn.precision !== newColumn.precision);\r\n        // console.log(oldColumn.precision, newColumn.precision);\r\n        // console.log(\"scale ---------------\");\r\n        // console.log(oldColumn.scale !== newColumn.scale);\r\n        // console.log(oldColumn.scale, newColumn.scale);\r\n        // console.log(\"default ---------------\");\r\n        // console.log((checkDefault && oldColumn.default !== newColumn.default));\r\n        // console.log(oldColumn.default, newColumn.default);\r\n        // console.log(\"isNullable ---------------\");\r\n        // console.log(oldColumn.isNullable !== newColumn.isNullable);\r\n        // console.log(oldColumn.isNullable, newColumn.isNullable);\r\n        // console.log(\"comment ---------------\");\r\n        // console.log((checkComment && oldColumn.comment !== newColumn.comment));\r\n        // console.log(oldColumn.comment, newColumn.comment);\r\n        // console.log(\"enum ---------------\");\r\n        // console.log(oldColumn.enum !== newColumn.enum);\r\n        // console.log(oldColumn.enum, newColumn.enum);\r\n\r\n        return oldColumn.charset !== newColumn.charset\r\n            || oldColumn.collation !== newColumn.collation\r\n            || oldColumn.precision !== newColumn.precision\r\n            || oldColumn.scale !== newColumn.scale\r\n            || oldColumn.width !== newColumn.width // MySQL only\r\n            || oldColumn.zerofill !== newColumn.zerofill // MySQL only\r\n            || oldColumn.unsigned !== newColumn.unsigned // MySQL only\r\n            || oldColumn.asExpression !== newColumn.asExpression // MySQL only\r\n            || (checkDefault && oldColumn.default !== newColumn.default)\r\n            || oldColumn.onUpdate !== newColumn.onUpdate // MySQL only\r\n            || oldColumn.isNullable !== newColumn.isNullable\r\n            || (checkComment && oldColumn.comment !== newColumn.comment)\r\n            || oldColumn.enum !== newColumn.enum;\r\n    }\r\n\r\n    /**\r\n     * Checks if column length is by default.\r\n     */\r\n    protected isDefaultColumnLength(table: Table, column: TableColumn, length: string): boolean {\r\n        // if table have metadata, we check if length is specified in column metadata\r\n        if (this.connection.hasMetadata(table.name)) {\r\n            const metadata = this.connection.getMetadata(table.name);\r\n            const columnMetadata = metadata.findColumnWithDatabaseName(column.name);\r\n            if (columnMetadata && columnMetadata.length)\r\n                return false;\r\n        }\r\n\r\n        if (this.connection.driver.dataTypeDefaults\r\n            && this.connection.driver.dataTypeDefaults[column.type]\r\n            && this.connection.driver.dataTypeDefaults[column.type].length) {\r\n            return this.connection.driver.dataTypeDefaults[column.type].length!.toString() === length.toString();\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Checks if column display width is by default. Used only for MySQL.\r\n     */\r\n    protected isDefaultColumnWidth(table: Table, column: TableColumn, width: number): boolean {\r\n        // if table have metadata, we check if length is specified in column metadata\r\n        if (this.connection.hasMetadata(table.name)) {\r\n            const metadata = this.connection.getMetadata(table.name);\r\n            const columnMetadata = metadata.findColumnWithDatabaseName(column.name);\r\n            if (columnMetadata && columnMetadata.width)\r\n                return false;\r\n        }\r\n\r\n        if (this.connection.driver.dataTypeDefaults\r\n            && this.connection.driver.dataTypeDefaults[column.type]\r\n            && this.connection.driver.dataTypeDefaults[column.type].width) {\r\n            return this.connection.driver.dataTypeDefaults[column.type].width === width;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Checks if column precision is by default.\r\n     */\r\n    protected isDefaultColumnPrecision(table: Table, column: TableColumn, precision: number): boolean {\r\n        // if table have metadata, we check if length is specified in column metadata\r\n        if (this.connection.hasMetadata(table.name)) {\r\n            const metadata = this.connection.getMetadata(table.name);\r\n            const columnMetadata = metadata.findColumnWithDatabaseName(column.name);\r\n            if (columnMetadata && columnMetadata.precision !== null && columnMetadata.precision !== undefined)\r\n                return false;\r\n        }\r\n\r\n        if (this.connection.driver.dataTypeDefaults\r\n            && this.connection.driver.dataTypeDefaults[column.type]\r\n            && this.connection.driver.dataTypeDefaults[column.type].precision !== null\r\n            && this.connection.driver.dataTypeDefaults[column.type].precision !== undefined)\r\n            return this.connection.driver.dataTypeDefaults[column.type].precision === precision;\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Checks if column scale is by default.\r\n     */\r\n    protected isDefaultColumnScale(table: Table, column: TableColumn, scale: number): boolean {\r\n        // if table have metadata, we check if length is specified in column metadata\r\n        if (this.connection.hasMetadata(table.name)) {\r\n            const metadata = this.connection.getMetadata(table.name);\r\n            const columnMetadata = metadata.findColumnWithDatabaseName(column.name);\r\n            if (columnMetadata && columnMetadata.scale !== null && columnMetadata.scale !== undefined)\r\n                return false;\r\n        }\r\n\r\n        if (this.connection.driver.dataTypeDefaults\r\n            && this.connection.driver.dataTypeDefaults[column.type]\r\n            && this.connection.driver.dataTypeDefaults[column.type].scale !== null\r\n            && this.connection.driver.dataTypeDefaults[column.type].scale !== undefined)\r\n            return this.connection.driver.dataTypeDefaults[column.type].scale === scale;\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Executes sql used special for schema build.\r\n     */\r\n    protected async executeQueries(upQueries: string|string[], downQueries: string|string[]): Promise<void> {\r\n        if (typeof upQueries === \"string\")\r\n            upQueries = [upQueries];\r\n        if (typeof downQueries === \"string\")\r\n            downQueries = [downQueries];\r\n\r\n        this.sqlInMemory.upQueries.push(...upQueries);\r\n        this.sqlInMemory.downQueries.push(...downQueries);\r\n\r\n        // if sql-in-memory mode is enabled then simply store sql in memory and return\r\n        if (this.sqlMemoryMode === true)\r\n            return Promise.resolve() as Promise<any>;\r\n\r\n        await PromiseUtils.runInSequence(upQueries, upQuery => this.query(upQuery));\r\n    }\r\n\r\n}"],"sourceRoot":".."}